<h1>API Tests: User / Auth / Token</h1>

<p>
  Page for tests of authentication and token validation.
  <br>1) Get token from <code>/user</code>
  <br>2) Use token to call protected <code>/discount</code>
  <br>3) Check negative cases and screenshots
</p>

<table>
  <thead>
    <tr>
      <th style="width:280px">Action</th>
      <th>Result</th>
    </tr>
  </thead>

  <tbody>
    <!-- BASIC TOKEN -->
    <tr>
      <td><button id="user-get-btn">GET /user (normal token)</button></td>
      <td id="user-get-result"></td>
    </tr>

    <tr>
      <td><b>Token Header (from response)</b></td>
      <td id="token-header-result"><pre>none</pre></td>
    </tr>

    <tr>
      <td><b>Token Header (decoded from token)</b></td>
      <td id="token-header-decoded"><pre>none</pre></td>
    </tr>

    <tr>
      <td><b>Current token</b></td>
      <td><code id="current-token">none</code></td>
    </tr>

    <tr><td colspan="2"><hr></td></tr>

    <!-- DISCOUNT OK -->
    <tr>
      <td><button id="discount-ok-btn">GET /discount (OK with current token)</button></td>
      <td id="discount-ok-result"></td>
    </tr>

    <tr><td colspan="2"><hr></td></tr>

    <!-- PRACTICE PROJECT - NEGATIVE AUTH CASES -->
    <tr>
      <td><b>Auth errors (header problems)</b></td>
      <td></td>
    </tr>

    <tr>
      <td><button id="discount-missing-auth-btn">NO Authorization header</button></td>
      <td id="discount-missing-auth-result"></td>
    </tr>

    <tr>
      <td><button id="discount-wrong-scheme-btn">Wrong scheme (Token ...)</button></td>
      <td id="discount-wrong-scheme-result"></td>
    </tr>

    <tr>
      <td><button id="discount-short-token-btn">Short token (2 parts only)</button></td>
      <td id="discount-short-token-result"></td>
    </tr>

    <tr>
      <td><button id="discount-bad-base64-btn">Bad base64 symbols</button></td>
      <td id="discount-bad-base64-result"></td>
    </tr>

    <tr>
      <td><button id="discount-bad-signature-btn">Bad signature</button></td>
      <td id="discount-bad-signature-result"></td>
    </tr>

    <tr>
      <td><button id="discount-expired-btn">Expired token</button></td>
      <td id="discount-expired-result"></td>
    </tr>

    <tr><td colspan="2"><hr></td></tr>

    <!-- JWT VALIDATION - NESTED -->
    <tr>
      <td><b>JWT validation: Nested JWT (cty=JWT)</b></td>
      <td></td>
    </tr>

    <tr>
      <td><button id="nested-ok-btn">Nested token OK -> /discount</button></td>
      <td id="nested-ok-result"></td>
    </tr>

    <tr>
      <td><button id="nested-expired-btn">Nested token expired -> /discount</button></td>
      <td id="nested-expired-result"></td>
    </tr>

    <tr><td colspan="2"><hr></td></tr>

    <!-- INTERNAL TOKEN CHECKS (THIS HW) -->
    <tr>
      <td><b>Internal token checks (claims validation)</b></td>
      <td style="font-size:12px; opacity:0.8;">
        sub=UUID, iss="Server-KN-P-221", name or email required, email format if present
      </td>
    </tr>

    <tr>
      <td><button id="claim-bad-sub-btn">bad_sub -> /discount (403)</button></td>
      <td id="claim-bad-sub-result"></td>
    </tr>

    <tr>
      <td><button id="claim-bad-iss-btn">bad_iss -> /discount (403)</button></td>
      <td id="claim-bad-iss-result"></td>
    </tr>

    <tr>
      <td><button id="claim-no-name-email-btn">no_name_email -> /discount (403)</button></td>
      <td id="claim-no-name-email-result"></td>
    </tr>

    <tr>
      <td><button id="claim-bad-email-btn">bad_email -> /discount (403)</button></td>
      <td id="claim-bad-email-result"></td>
    </tr>

    <tr>
      <td><button id="claim-email-only-btn">email_only -> /discount (200)</button></td>
      <td id="claim-email-only-result"></td>
    </tr>

    <tr>
      <td><button id="claim-name-only-btn">name_only -> /discount (200)</button></td>
      <td id="claim-name-only-result"></td>
    </tr>

  </tbody>
</table>
